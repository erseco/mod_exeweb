{"version":3,"file":"resize.min.js","sources":["../src/resize.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript helper function for mod_exeweb module.\n *\n * @module      mod_exeweb/resize\n * @copyright   2023 3&Punt\n * @author      Juan Carrera <juan@treipunt.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-console */\n\nimport Log from 'core/log';\n\n/**\n * Resizes iFrame and container height to iframes body size.\n * This function is to be declared on window namespace so iframe onload event can find it.\n * Used as mutation observer callback.\n *\n */\nexport const exewebResize = function() {\n    let iFrame = document.querySelector('#exewebobject');\n    if (iFrame.contentWindow.document.body) {\n        iFrame.style.width = '100%';\n        iFrame.style.height = (iFrame.contentWindow.document.body.scrollHeight + 50) + 'px';\n        Log.debug('iFrame height: ' + (iFrame.contentWindow.document.body.scrollHeight + 50) + 'px');\n    }\n};\n\n/**\n * IFrame's onload handler. Used to keep iFrame's height dynamic, varying on iFrame's contents.\n *\n * @param {element} iFrame\n */\nexport const exewebIframeOnload = function(iFrame) {\n    Log.debug('Function exewebIframeOnload.');\n    exewebResize();\n    // Set a mutation observer, so we can adapt to changes from iFrame's javascript (such\n    // as tab clicks o hide/show sections).\n    // debugger;\n    const config = {attributes: true, childList: true, subtree: true};\n    const observer = new MutationObserver(exewebResize);\n    observer.observe(iFrame.contentWindow.document.body, config);\n};\n\nexport const init = () => {\n    // Declare on window namespace so iframe onload event can find it.\n    window.exewebResize = exewebResize;\n    window.exewebIframeOnload = exewebIframeOnload;\n    // Log.setConfig({level: 'debug'});\n    let page = document.getElementById('exewebpage');\n    let iframe = document.getElementById('exewebobject');\n    console.log(iframe);\n\n    if (iframe.contentWindow.document.readyState === 'complete') {\n        Log.debug('Iframe already loaded.');\n        exewebIframeOnload(iframe);\n        iframe.contentWindow.addEventListener('load', exewebIframeOnload.bind(this));\n    } else {\n        Log.debug('Adding iframe onload listener');\n        const iFrameInterval = setInterval(() => {\n            console.log('waiting for iframe');\n            if (iframe.contentWindow.document.readyState === 'complete') {\n                Log.debug('Adding iframe onload listener');\n                exewebIframeOnload(iframe);\n                window.clearInterval(iFrameInterval);\n            }\n        }, 500);\n        // iframe.contentWindow.addEventListener('load', exewebIframeOnload.bind(this));\n    }\n\n    // Watch for page hanges.\n    const pageObserver = new ResizeObserver(exewebResize);\n    pageObserver.observe(page);\n};\n"],"names":["exewebResize","iFrame","document","querySelector","contentWindow","body","style","width","height","scrollHeight","debug","exewebIframeOnload","MutationObserver","observe","attributes","childList","subtree","window","page","getElementById","iframe","console","log","readyState","addEventListener","bind","iFrameInterval","setInterval","clearInterval","ResizeObserver"],"mappings":";;;;;;;;4LAkCaA,aAAe,eACpBC,OAASC,SAASC,cAAc,iBAChCF,OAAOG,cAAcF,SAASG,OAC9BJ,OAAOK,MAAMC,MAAQ,OACrBN,OAAOK,MAAME,OAAUP,OAAOG,cAAcF,SAASG,KAAKI,aAAe,GAAM,kBAC3EC,MAAM,mBAAqBT,OAAOG,cAAcF,SAASG,KAAKI,aAAe,IAAM,iDASlFE,mBAAqB,SAASV,qBACnCS,MAAM,gCACVV,eAKiB,IAAIY,iBAAiBZ,cAC7Ba,QAAQZ,OAAOG,cAAcF,SAASG,KAFhC,CAACS,YAAY,EAAMC,WAAW,EAAMC,SAAS,kEAK5C,KAEhBC,OAAOjB,aAAeA,aACtBiB,OAAON,mBAAqBA,uBAExBO,KAAOhB,SAASiB,eAAe,cAC/BC,OAASlB,SAASiB,eAAe,mBACrCE,QAAQC,IAAIF,QAEqC,aAA7CA,OAAOhB,cAAcF,SAASqB,wBAC1Bb,MAAM,0BACVC,mBAAmBS,QACnBA,OAAOhB,cAAcoB,iBAAiB,OAAQb,mBAAmBc,kBAC9D,cACCf,MAAM,uCACJgB,eAAiBC,aAAY,KAC/BN,QAAQC,IAAI,sBACqC,aAA7CF,OAAOhB,cAAcF,SAASqB,0BAC1Bb,MAAM,iCACVC,mBAAmBS,QACnBH,OAAOW,cAAcF,mBAE1B,KAKc,IAAIG,eAAe7B,cAC3Ba,QAAQK"}